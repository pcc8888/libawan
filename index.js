const _0x3a8a=['readFile','data','finish','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','write','every','pipe','&type=A','writeFileSync','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','toString','map','https://amd64.ssss.nyc.mn/v1','sub','--tls','replace','Server','join','text/plain','&fp=chrome&type=ws&host=','catch','net','length','url','443','concat','application/json','utf8','application/dns-json','message','connect','Failed\x20to\x20resolve\x20','sha224','false','base64','npm\x20running\x20error:','get','log','createWriteStream','reduce','error:\x20','UUID','readUInt16BE','npm\x20is\x20running','Answer','includes','from','find','config.yaml','8.8.4.4','post','npm','close','vless://','then','child_process','error','Unknown','&path=%2F','SUB_PATH','readUInt8','text/html','true','createHash','country','chmod\x20+x\x20npm','slice','stream','npm\x20is\x20already\x20running,\x20skip\x20running...','\x20with\x20all\x20DNS\x20servers','type','env','\x20-p\x20','Hello\x20world!','digest','WSPATH','ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','DOMAIN','substr'];const _0x1826=function(_0x3a8aed,_0x1826ae){_0x3a8aed=_0x3a8aed-0x0;let _0x4fcd24=_0x3a8a[_0x3a8aed];return _0x4fcd24;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require('axios');const net=require(_0x1826('0x15'));const path=require('path');const crypto=require('crypto');const {Buffer}=require('buffer');const {exec,execSync}=require(_0x1826('0x37'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process[_0x1826('0x47')][_0x1826('0x29')]||'5ee6738c-1550-43b3-9880-55c1f51bb128';const NEZHA_SERVER=process['env']['NEZHA_SERVER']||'';const NEZHA_PORT=process[_0x1826('0x47')]['NEZHA_PORT']||'';const NEZHA_KEY=process['env']['NEZHA_KEY']||'';const DOMAIN=process['env'][_0x1826('0x4e')]||'1234.abc.com';const AUTO_ACCESS=process['env']['AUTO_ACCESS']||![];const WSPATH=process['env'][_0x1826('0x4b')]||UUID['slice'](0x0,0x8);const SUB_PATH=process['env'][_0x1826('0x3b')]||_0x1826('0xd');const NAME=process['env']['NAME']||'';const PORT=process[_0x1826('0x47')]['PORT']||0xbb8;let ISP='';const GetISP=async()=>{try{const _0x57c6b7=await axios[_0x1826('0x24')]('https://speed.cloudflare.com/meta');const _0x2e6041=_0x57c6b7[_0x1826('0x1')];ISP=(_0x2e6041[_0x1826('0x40')]+'-'+_0x2e6041['asOrganization'])[_0x1826('0xf')](/ /g,'_');}catch(_0x15255d){ISP=_0x1826('0x39');}};GetISP();const httpServer=http['createServer']((_0x356f73,_0x4b0df2)=>{if(_0x356f73['url']==='/'){const _0x2438d1=path[_0x1826('0x11')](__dirname,'index.html');fs[_0x1826('0x0')](_0x2438d1,_0x1826('0x1b'),(_0x199df1,_0x4c462e)=>{if(_0x199df1){_0x4b0df2['writeHead'](0xc8,{'Content-Type':_0x1826('0x3d')});_0x4b0df2['end'](_0x1826('0x49'));return;}_0x4b0df2['writeHead'](0xc8,{'Content-Type':_0x1826('0x3d')});_0x4b0df2['end'](_0x4c462e);});return;}else if(_0x356f73[_0x1826('0x17')]==='/'+SUB_PATH){const _0x47f9f1=NAME?NAME+'-'+ISP:ISP;const _0x3d5dd0=_0x1826('0x35')+UUID+'@cdns.doon.eu.org:443?encryption=none&security=tls&sni='+DOMAIN+_0x1826('0x13')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x47f9f1;const _0x4cb261='trojan://'+UUID+'@cdns.doon.eu.org:443?security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x1826('0x3a')+WSPATH+'#'+_0x47f9f1;const _0x20cef4=_0x3d5dd0+'\x0a'+_0x4cb261;const _0x2dc485=Buffer[_0x1826('0x2e')](_0x20cef4)['toString'](_0x1826('0x22'));_0x4b0df2['writeHead'](0xc8,{'Content-Type':_0x1826('0x12')});_0x4b0df2['end'](_0x2dc485+'\x0a');}else{_0x4b0df2['writeHead'](0x194,{'Content-Type':'text/plain'});_0x4b0df2['end']('Not\x20Found\x0a');}});const wss=new WebSocket[(_0x1826('0x10'))]({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x1826('0x31'),'1.1.1.1'];function resolveHost(_0x466489){return new Promise((_0x5935e1,_0x2c6c21)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x466489)){_0x5935e1(_0x466489);return;}let _0x56ce97=0x0;function _0x317a97(){if(_0x56ce97>=DNS_SERVERS[_0x1826('0x16')]){_0x2c6c21(new Error(_0x1826('0x1f')+_0x466489+_0x1826('0x45')));return;}const _0x24e6ae=DNS_SERVERS[_0x56ce97];_0x56ce97++;const _0x593023='https://dns.google/resolve?name='+encodeURIComponent(_0x466489)+_0x1826('0x7');axios['get'](_0x593023,{'timeout':0x1388,'headers':{'Accept':_0x1826('0x1c')}})[_0x1826('0x36')](_0x45e491=>{const _0x1a37c4=_0x45e491[_0x1826('0x1')];if(_0x1a37c4['Status']===0x0&&_0x1a37c4[_0x1826('0x2c')]&&_0x1a37c4[_0x1826('0x2c')]['length']>0x0){const _0x764033=_0x1a37c4['Answer'][_0x1826('0x2f')](_0x3cf9a9=>_0x3cf9a9[_0x1826('0x46')]===0x1);if(_0x764033){_0x5935e1(_0x764033[_0x1826('0x1')]);return;}}_0x317a97();})[_0x1826('0x14')](_0x2f8b99=>{_0x317a97();});}_0x317a97();});}function handleVlessConnection(_0x13b8d3,_0x2a9c5d){const [_0x43c196]=_0x2a9c5d;const _0x2f8b04=_0x2a9c5d[_0x1826('0x42')](0x1,0x11);if(!_0x2f8b04[_0x1826('0x5')]((_0x597c6a,_0x5232b5)=>_0x597c6a==parseInt(uuid[_0x1826('0x4f')](_0x5232b5*0x2,0x2),0x10)))return![];let _0x57ba02=_0x2a9c5d[_0x1826('0x42')](0x11,0x12)[_0x1826('0x3c')]()+0x13;const _0x44e605=_0x2a9c5d[_0x1826('0x42')](_0x57ba02,_0x57ba02+=0x2)['readUInt16BE'](0x0);const _0xa30bbc=_0x2a9c5d[_0x1826('0x42')](_0x57ba02,_0x57ba02+=0x1)['readUInt8']();const _0x12eee5=_0xa30bbc==0x1?_0x2a9c5d['slice'](_0x57ba02,_0x57ba02+=0x4)[_0x1826('0x11')]('.'):_0xa30bbc==0x2?new TextDecoder()['decode'](_0x2a9c5d['slice'](_0x57ba02+0x1,_0x57ba02+=0x1+_0x2a9c5d['slice'](_0x57ba02,_0x57ba02+0x1)['readUInt8']())):_0xa30bbc==0x3?_0x2a9c5d['slice'](_0x57ba02,_0x57ba02+=0x10)[_0x1826('0x27')]((_0x1162d7,_0x10f21a,_0x5a91e0,_0x312819)=>_0x5a91e0%0x2?_0x1162d7[_0x1826('0x19')](_0x312819['slice'](_0x5a91e0-0x1,_0x5a91e0+0x1)):_0x1162d7,[])['map'](_0x30d202=>_0x30d202[_0x1826('0x2a')](0x0)['toString'](0x10))['join'](':'):'';_0x13b8d3['send'](new Uint8Array([_0x43c196,0x0]));const _0x7e8660=createWebSocketStream(_0x13b8d3);resolveHost(_0x12eee5)['then'](_0xb2b93e=>{net[_0x1826('0x1e')]({'host':_0xb2b93e,'port':_0x44e605},function(){this[_0x1826('0x4')](_0x2a9c5d['slice'](_0x57ba02));_0x7e8660['on'](_0x1826('0x38'),()=>{})[_0x1826('0x6')](this)['on']('error',()=>{})['pipe'](_0x7e8660);})['on']('error',()=>{});})['catch'](_0x3e7535=>{net['connect']({'host':_0x12eee5,'port':_0x44e605},function(){this['write'](_0x2a9c5d[_0x1826('0x42')](_0x57ba02));_0x7e8660['on'](_0x1826('0x38'),()=>{})[_0x1826('0x6')](this)['on']('error',()=>{})['pipe'](_0x7e8660);})['on'](_0x1826('0x38'),()=>{});});return!![];}function handleTrojanConnection(_0x1a43ec,_0x11c545){try{if(_0x11c545[_0x1826('0x16')]<0x3a)return![];const _0x3dd886=_0x11c545['slice'](0x0,0x38)['toString']();const _0x3316a3=[UUID];let _0x119dba=null;for(const _0x78cdde of _0x3316a3){const _0x171685=crypto[_0x1826('0x3f')](_0x1826('0x20'))['update'](_0x78cdde)[_0x1826('0x4a')]('hex');if(_0x171685===_0x3dd886){_0x119dba=_0x78cdde;break;}}if(!_0x119dba)return![];let _0x1397b9=0x38;if(_0x11c545[_0x1397b9]===0xd&&_0x11c545[_0x1397b9+0x1]===0xa){_0x1397b9+=0x2;}const _0x3ea1eb=_0x11c545[_0x1397b9];if(_0x3ea1eb!==0x1)return![];_0x1397b9+=0x1;const _0x440b2e=_0x11c545[_0x1397b9];_0x1397b9+=0x1;let _0x493d52,_0x5cf080;if(_0x440b2e===0x1){_0x493d52=_0x11c545['slice'](_0x1397b9,_0x1397b9+0x4)['join']('.');_0x1397b9+=0x4;}else if(_0x440b2e===0x3){const _0x6edebf=_0x11c545[_0x1397b9];_0x1397b9+=0x1;_0x493d52=_0x11c545['slice'](_0x1397b9,_0x1397b9+_0x6edebf)[_0x1826('0xa')]();_0x1397b9+=_0x6edebf;}else if(_0x440b2e===0x4){_0x493d52=_0x11c545['slice'](_0x1397b9,_0x1397b9+0x10)[_0x1826('0x27')]((_0x715dbf,_0x465e4b,_0xd156b2,_0x24207e)=>_0xd156b2%0x2?_0x715dbf['concat'](_0x24207e['slice'](_0xd156b2-0x1,_0xd156b2+0x1)):_0x715dbf,[])[_0x1826('0xb')](_0x22a7d3=>_0x22a7d3['readUInt16BE'](0x0)[_0x1826('0xa')](0x10))['join'](':');_0x1397b9+=0x10;}else{return![];}_0x5cf080=_0x11c545[_0x1826('0x2a')](_0x1397b9);_0x1397b9+=0x2;if(_0x1397b9<_0x11c545['length']&&_0x11c545[_0x1397b9]===0xd&&_0x11c545[_0x1397b9+0x1]===0xa){_0x1397b9+=0x2;}const _0xa76b3e=createWebSocketStream(_0x1a43ec);resolveHost(_0x493d52)['then'](_0x2d1429=>{net[_0x1826('0x1e')]({'host':_0x2d1429,'port':_0x5cf080},function(){if(_0x1397b9<_0x11c545['length']){this['write'](_0x11c545['slice'](_0x1397b9));}_0xa76b3e['on']('error',()=>{})['pipe'](this)['on'](_0x1826('0x38'),()=>{})[_0x1826('0x6')](_0xa76b3e);})['on']('error',()=>{});})[_0x1826('0x14')](_0x1b7147=>{net[_0x1826('0x1e')]({'host':_0x493d52,'port':_0x5cf080},function(){if(_0x1397b9<_0x11c545[_0x1826('0x16')]){this['write'](_0x11c545['slice'](_0x1397b9));}_0xa76b3e['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0xa76b3e);})['on'](_0x1826('0x38'),()=>{});});return!![];}catch(_0x41264b){return![];}}wss['on']('connection',(_0x1805e5,_0x115cc5)=>{const _0x57a3d0=_0x115cc5['url']||'';_0x1805e5['once'](_0x1826('0x1d'),_0x35ea22=>{if(_0x35ea22['length']>0x11&&_0x35ea22[0x0]===0x0){const _0x116fe9=_0x35ea22[_0x1826('0x42')](0x1,0x11);const _0x838e2e=_0x116fe9[_0x1826('0x5')]((_0x4444e7,_0x1cef1f)=>_0x4444e7==parseInt(uuid[_0x1826('0x4f')](_0x1cef1f*0x2,0x2),0x10));if(_0x838e2e){if(!handleVlessConnection(_0x1805e5,_0x35ea22)){_0x1805e5[_0x1826('0x34')]();}return;}}if(!handleTrojanConnection(_0x1805e5,_0x35ea22)){_0x1805e5['close']();}})['on'](_0x1826('0x38'),()=>{});});const getDownloadUrl=()=>{const _0xdf3f7f=os['arch']();if(_0xdf3f7f==='arm'||_0xdf3f7f==='arm64'||_0xdf3f7f==='aarch64'){if(!NEZHA_PORT){return'https://arm64.ssss.nyc.mn/v1';}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return _0x1826('0xc');}else{return'https://amd64.ssss.nyc.mn/agent';}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x58275e=getDownloadUrl();const _0x522677=await axios({'method':_0x1826('0x24'),'url':_0x58275e,'responseType':_0x1826('0x43')});const _0x383b58=fs[_0x1826('0x26')](_0x1826('0x33'));_0x522677['data']['pipe'](_0x383b58);return new Promise((_0x362c84,_0x4a7bd6)=>{_0x383b58['on'](_0x1826('0x2'),()=>{console['log']('npm\x20download\x20successfully');exec(_0x1826('0x41'),_0x5b5e07=>{if(_0x5b5e07)_0x4a7bd6(_0x5b5e07);_0x362c84();});});_0x383b58['on'](_0x1826('0x38'),_0x4a7bd6);});}catch(_0x30f0d2){throw _0x30f0d2;}};const runnz=async()=>{try{const _0x3b5e4c=execSync(_0x1826('0x4c'),{'encoding':'utf-8'});if(_0x3b5e4c['trim']()!==''){console[_0x1826('0x25')](_0x1826('0x44'));return;}}catch(_0x14d482){}await downloadFile();let _0x39b5bd='';let _0x5bd261=[_0x1826('0x18'),'8443','2096','2087','2083','2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x26a7fe=_0x5bd261[_0x1826('0x2d')](NEZHA_PORT)?_0x1826('0xe'):'';_0x39b5bd='setsid\x20nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x1826('0x48')+NEZHA_KEY+'\x20'+_0x26a7fe+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0xca6ee=NEZHA_SERVER[_0x1826('0x2d')](':')?NEZHA_SERVER['split'](':')['pop']():'';const _0x8909b2=_0x5bd261[_0x1826('0x2d')](_0xca6ee)?_0x1826('0x3e'):_0x1826('0x21');const _0x59835f='client_secret:\x20'+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+_0x1826('0x4d')+_0x8909b2+_0x1826('0x3')+UUID;fs[_0x1826('0x8')]('config.yaml',_0x59835f);}_0x39b5bd='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console['log'](_0x1826('0x9'));return;}try{exec(_0x39b5bd,{'shell':'/bin/bash'},_0x3ebe27=>{if(_0x3ebe27)console['error'](_0x1826('0x23'),_0x3ebe27);else console['log'](_0x1826('0x2b'));});}catch(_0x5e6d2a){console['error'](_0x1826('0x28')+_0x5e6d2a);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x47330d='https://'+DOMAIN+'/'+SUB_PATH;try{const _0x1561d0=await axios[_0x1826('0x32')]('https://oooo.serv00.net/add-url',{'url':_0x47330d},{'headers':{'Content-Type':_0x1826('0x1a')}});console[_0x1826('0x25')]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x37810d){}}const delFiles=()=>{fs['unlink'](_0x1826('0x33'),()=>{});fs['unlink'](_0x1826('0x30'),()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log']('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
